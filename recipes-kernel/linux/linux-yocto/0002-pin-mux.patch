From 8713aec6085b8d9875bc4d0a787b1f23a42bc966 Mon Sep 17 00:00:00 2001
From: Petr Pavlata <petr@acrux.cz>
Date: Tue, 28 Jun 2022 14:21:14 +0200
Subject: [PATCH] pin mux

---
 .../arm64/boot/dts/rockchip/rk3328-lpi-cm.dts | 331 ++++++++++++------
 1 file changed, 222 insertions(+), 109 deletions(-)

diff --git a/arch/arm64/boot/dts/rockchip/rk3328-lpi-cm.dts b/arch/arm64/boot/dts/rockchip/rk3328-lpi-cm.dts
index f5cb010a4092..fa9d0a17ce98 100644
--- a/arch/arm64/boot/dts/rockchip/rk3328-lpi-cm.dts
+++ b/arch/arm64/boot/dts/rockchip/rk3328-lpi-cm.dts
@@ -4,7 +4,7 @@
 #include "rk3328.dtsi"
 
 / {
-	model = "ClearTex LPI-CM";
+	model = "ClearTex LPI-CM v0.1";
 	compatible = "cleartex,lpicm", "rockchip,rk3328";
 
 	aliases {
@@ -15,47 +15,18 @@ aliases {
 	chosen {
 		stdout-path = "serial2:115200n8";
 	};
-/*
-	gmac_clkin: external-gmac-clock {
-		compatible = "fixed-clock";
-		clock-frequency = <125000000>;
-		clock-output-names = "gmac_clkin";
-		#clock-cells = <0>;
-	};
-*/
+
 	vcc_sd: sdmmc-regulator {
 		compatible = "regulator-fixed";
-		gpio = <&gpio0 RK_PD6 GPIO_ACTIVE_LOW>;
+	/*	gpio = <&gpio0 RK_PD6 GPIO_ACTIVE_LOW>;*/
 		pinctrl-names = "default";
-		pinctrl-0 = <&sdmmc0m1_pin>;
+	/*	pinctrl-0 = <&sdmmc0m1_pin>;*/
 		regulator-name = "vcc_sd";
 		regulator-min-microvolt = <3300000>;
 		regulator-max-microvolt = <3300000>;
 		vin-supply = <&vcc_io>;
 	};
 
-	vcc_host_5v: vcc-host-5v-regulator {
-		compatible = "regulator-fixed";
-		gpio = <&gpio0 RK_PA2 GPIO_ACTIVE_LOW>;
-		pinctrl-names = "default";
-		pinctrl-0 = <&usb20_host_drv>;
-		regulator-name = "vcc_host_5v";
-		regulator-always-on;
-		regulator-boot-on;
-		vin-supply = <&vcc_sys>;
-	};
-
-	vcc_host1_5v: vcc_otg_5v: vcc-host1-5v-regulator {
-		compatible = "regulator-fixed";
-		gpio = <&gpio0 RK_PA2 GPIO_ACTIVE_LOW>;
-		pinctrl-names = "default";
-		pinctrl-0 = <&usb20_host_drv>;
-		regulator-name = "vcc_host1_5v";
-		regulator-always-on;
-		regulator-boot-on;
-		vin-supply = <&vcc_sys>;
-	};
-
 	vcc_sys: vcc-sys {
 		compatible = "regulator-fixed";
 		regulator-name = "vcc_sys";
@@ -67,28 +38,234 @@ vcc_sys: vcc-sys {
 
 	leds {
 		compatible = "gpio-leds";
+		pinctrl-0 = <&pin_LED1 &pin_SOM_DEBUG_GPIO2>;
+		pinctrl-names = "default";
 
-		power_led: led-0 {
-			gpios = <&rk805 1 GPIO_ACTIVE_LOW>;
-			linux,default-trigger = "mmc0";
+		heartbeat_led: led-0 {
+			gpios = <&gpio2 RK_PC5 GPIO_ACTIVE_HIGH>;
+			linux,default-trigger = "heartbeat";
 		};
 
-		standby_led: led-1 {
-			gpios = <&rk805 0 GPIO_ACTIVE_LOW>;
+		SOM_DEBUG_GPIO2_led: SOM_DEBUG_GPIO2-0 {
+			gpios = <&gpio2 RK_PA0 GPIO_ACTIVE_HIGH>;
 			linux,default-trigger = "heartbeat";
 		};
+
+	};
+
+	spi0: spi@ff190000 {
+		compatible = "rockchip,rk3328-spi", "rockchip,rk3066-spi";
+		reg = <0x0 0xff190000 0x0 0x1000>;
+		interrupts = <GIC_SPI 49 IRQ_TYPE_LEVEL_HIGH>;
+		#address-cells = <1>;
+		#size-cells = <0>;
+		clocks = <&cru SCLK_SPI>, <&cru PCLK_SPI>;
+		clock-names = "spiclk", "apb_pclk";
+		dmas = <&dmac 8>, <&dmac 9>;
+		dma-names = "tx", "rx";
+		pinctrl-names = "default";
+		pinctrl-0 = <&spi0m2_clk &spi0m2_rx &spi0m2_rx &spi0m2_cs0>;
+		status = "okay";
 	};
 
+	uart1: serial@ff120000 {
+		compatible = "rockchip,rk3328-uart", "snps,dw-apb-uart";
+		reg = <0x0 0xff120000 0x0 0x100>;
+		interrupts = <GIC_SPI 56 IRQ_TYPE_LEVEL_HIGH>;
+		clocks = <&cru SCLK_UART1>, <&cru PCLK_UART1>;
+		clock-names = "baudclk", "apb_pclk";
+		dmas = <&dmac 4>, <&dmac 5>;
+		dma-names = "tx", "rx";
+		pinctrl-names = "default";
+		pinctrl-0 = <&uart1_xfer>;
+		reg-io-width = <4>;
+		reg-shift = <2>;
+		status = "okay";
+	};
+};
 
+&gpio0 {
+	gpio-line-names = 
+ 	/* GPIO0  */
+	"SOM_PWRDN_REQ_OUT", "","SOM_PWRDN_REQ_IN","","MCU_BOOT1","","","",
+	"", "","","","","","","",
+	"", "","","","","","","",
+	"", "","","GPIO0","","","SOM_WD_TRIG","";
+	gpio-list = <&pin_SOM_WD_TRIG>,<&pin_MCU_BOOT1>,  <&pin_SOM_PUSH_BUTTON_2> ;
 };
 
+&gpio1 {
+	gpio-line-names = 
+ 	/* GPIO1  */
+	"", "","","","","STM_RESET","","",
+	"", "","SOM_DEBUG_GPIO1","","","SOM_BUZZER_ENABLE","IO_RESET","",
+	"", "NetCON7_30","","RPI_FTDI_RESET","","BEDW_TEST","SOM_PUSH_BUTTON_2","ACP_ENABLE",
+	"NetCON7_76", "SOM_DC_INPUT_STATUS","MCU_BOOT0","","","","","";
+};
 
-/******************************************************/
-/*      LINET Specific MAP */
-&uart1 {
+&gpio2 {
+	gpio-line-names = 
+ 	/* GPIO2  */
+	"SOM_DEBUG_GPIO2", "RTC_INT","NetCON7_90","NetCON7_5","","","","",
+	"", "","","","","","","CHARGER_STAT1",
+	"MCU_SOM_NCR_EN", "NetCON7_78","CHARGER_STAT2","","BEDW_CS","","NetCON7_28","MCU_SOM_NCR_STATUS",
+	"SOM_I2C1_SCL", "SOM_I2C1_SDA","","","","","","";
+};
+&gpio3 {
+	gpio-line-names = 
+ 	/* GPIO3  */
+	"BEDW_CLK", "CHARGER_ACPR","BEDW_SDO","MCU_USART1_RX","","ETH_SPEED","MCU_USART1_TX","ETH_LINK",
+	"", "","","","","","","",
+	"", "","","","","","","",
+	"", "","","","","","","";
+};
+
+/*
+&uart2 {
+	status = "okay";
+};
+*/
+
+&pinctrl {
+	gpio0 {
+		pin_SOM_WD_TRIG: pin-SOM_WD_TRIG {
+			rockchip,pins = <0 RK_PD6 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+		pin_MCU_BOOT1: pin-MCU_BOOT1 {
+			rockchip,pins = <0 RK_PA4 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+
+		pin_SOM_PUSH_BUTTON_2: pin-SOM_PUSH_BUTTON_2 {
+			rockchip,pins = <0 RK_PD6 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+	};
+	gpio1 {
+		pin_SOM_BUZZER_ENABLE: pin-SOM_BUZZER_ENABLE {
+			rockchip,pins = <1 RK_PB5 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+
+		pin_SOM_DEBUG_GPIO1: pin-SOM_DEBUG_GPIO1 {
+			rockchip,pins = <1 RK_PB2 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+		pin_STM_RESET: pin-STM_RESET {
+			rockchip,pins = <1 RK_PA5 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+
+		pin_SOM_DC_INPUT_STATUS: pin-SOM_DC_INPUT_STATUS {
+			rockchip,pins = <1 RK_PD1 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+
+		pin_BEDW_TEST: pin-BEDW_TEST {
+			rockchip,pins = <1 RK_PC5 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+
+		pin_ACP_ENABLE: pin-ACP_ENABLE {
+			rockchip,pins = <1 RK_PC7 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+
+		pin_RPI_FTDI_RESET: pin-RPI_FTDI_RESET {
+			rockchip,pins = <1 RK_PC3 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+
+		pin_NetCON7_30: pin-NetCON7_30 {
+			rockchip,pins = <1 RK_PC2 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+
+		pin_MCU_BOOT0: pin-MCU_BOOT0 {
+			rockchip,pins = <1 RK_PD2 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+
+		pin_SOM_DEBUG_GPIO2: pin-SOM_DEBUG_GPIO2 {
+			rockchip,pins = <2 RK_PA0 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+		pin_RTC_INT: pin-RTC_INT {
+			rockchip,pins = <1 RK_PB5 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+		pin_IO_RESET: pin-IO_RESET {
+			rockchip,pins = <1 RK_PB6 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+
+		pin_NetCON7_76: pin-NetCON7_76 {
+			rockchip,pins = <1 RK_PD0 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+		pin_NetCON7_78: pin-NetCON7_78 {
+			rockchip,pins = <1 RK_PC5 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+		pin_NetCON7_90: pin-NetCON7_90 {
+			rockchip,pins = <1 RK_PD2 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+	};
+	gpio2 {
+		pin_NetCON7_28: pin-NetCON7_28 {
+			rockchip,pins = <2 RK_PC6 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+		pin_NetCON7_5: pin-NetCON7_5 {
+			rockchip,pins = <2 RK_PA3 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+		pin_CHARGER_STAT1: pin-CHARGER_STAT1 {
+			rockchip,pins = <2 RK_PB2 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+		pin_CHARGER_STAT2: pin-CHARGER_STAT2 {
+			rockchip,pins = <2 RK_PC2 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+		pin_MCU_SOM_NCR_EN: pin-MCU_SOM_NCR_EN {
+			rockchip,pins = <2 RK_PC0 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+		pin_MCU_SOM_NCR_STATUS: pin-MCU_SOM_NCR_STATUS {
+			rockchip,pins = <2 RK_PC7 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+		pin_BEDW_CS: pin-BEDW_CS {
+			rockchip,pins = <2 RK_PC4 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+
+		pin_LED1: pin-LED1 {
+			rockchip,pins = <2 RK_PC5 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+
+	};
+	gpio3 {
+		pin_CHARGER_ACPR: pin-CHARGER_ACPR {
+			rockchip,pins = <3 RK_PA1 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+
+		pin_ETH_LINK: pin-ETH_LINK {
+			rockchip,pins = <3 RK_PA7 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+		pin_ETH_SPEED: pin-ETH_SPEED {
+			rockchip,pins = <3 RK_PA5 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+
+		pin_SOM_PWRDN_REQ_IN: pin-SOM_PWRDN_REQ_IN {
+			rockchip,pins = <3 RK_PA1 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+		pin_SOM_PWRDN_REQ_OUT: pin-SOM_PWRDN_REQ_OUT {
+			rockchip,pins = <3 RK_PA0 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+	};
+
+
+
+	pmic {
+		pmic_int_l: pmic-int-l {
+			rockchip,pins = <2 RK_PA6 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+	};
+
+	usb2 {
+		usb20_host_drv: usb20-host-drv {
+			rockchip,pins = <0 RK_PA2 RK_FUNC_GPIO &pcfg_pull_none>;
+		};
+	};
+};
+
+
+/* I2C SOM 44-45*/
+
+&i2c0 {
 	status = "okay";
 };
 
+
 &i2c3 {
 	status = "okay";
 };
@@ -112,17 +289,6 @@ &usb20_otg {
 };
 
 
-&spi0 {
-	status = "okay";
-
-	flash@0 {
-		compatible = "jedec,spi-nor";
-		reg = <0>;
-
-		/* maximum speed for Rockchip SPI */
-		spi-max-frequency = <50000000>;
-	};
-};
 
 
 /******************************************************/
@@ -156,18 +322,6 @@ &emmc {
 };
 
 
-&hdmi {
-	status = "okay";
-};
-
-&hdmi_sound {
-	status = "okay";
-};
-
-&hdmiphy {
-	status = "okay";
-};
-
 &i2c1 {
 	status = "okay";
 
@@ -279,14 +433,6 @@ regulator-state-mem {
 	};
 };
 
-&i2s0 {
-	status = "okay";
-};
-
-&i2s1 {
-	status = "okay";
-};
-
 &io_domains {
 	status = "okay";
 
@@ -299,26 +445,7 @@ &io_domains {
 	pmuio-supply = <&vcc_io>;
 };
 
-&pinctrl {
-	ir {
-		ir_int: ir-int {
-			rockchip,pins = <2 RK_PA2 RK_FUNC_GPIO &pcfg_pull_none>;
-		};
-	};
-
-	pmic {
-		pmic_int_l: pmic-int-l {
-			rockchip,pins = <2 RK_PA6 RK_FUNC_GPIO &pcfg_pull_up>;
-		};
-	};
-
-	usb2 {
-		usb20_host_drv: usb20-host-drv {
-			rockchip,pins = <0 RK_PA2 RK_FUNC_GPIO &pcfg_pull_none>;
-		};
-	};
-};
-
+/*
 &sdmmc {
 	bus-width = <4>;
 	cap-mmc-highspeed;
@@ -330,25 +457,9 @@ &sdmmc {
 	vmmc-supply = <&vcc_sd>;
 	status = "okay";
 };
-
-&spdif {
-	pinctrl-0 = <&spdifm0_tx>;
-	status = "okay";
-};
-
-
-
-&tsadc {
-	rockchip,hw-tshut-mode = <0>;
-	rockchip,hw-tshut-polarity = <0>;
-	status = "okay";
-};
-
+*/
 
 
-&uart2 {
-	status = "okay";
-};
 
 &u2phy {
 	status = "okay";
@@ -367,10 +478,12 @@ &usb20_otg {
 	status = "okay";
 };
 
+/*
 &usbdrd3 {
 	dr_mode = "host";
 	status = "okay";
 };
+*/
 
 &usb_host0_ehci {
 	status = "okay";
